# О работе "Большой проект по предсказанию увольнений сотрудников и удовлетворенности через методы машинного обучения. Анализ факторов, влияющих на решение о расторжении трудового договора и вовлеченности сотрудников."

Решил две бизнес задачи:
Первая - построить модель, которая сможет
предсказать уровень удовлетворённости сотрудника на основе данных заказчика.
Почему бизнесу это важно: удовлетворённость работой напрямую влияет на
отток сотрудников. А предсказание оттока - одна из важнейших задач HR-
аналитиков. Внезапные увольнения несут в себе риски для компании, особенно
если уходит важный сотрудник.

Вторая задача - построить модель, которая сможет на основе данных
заказчика предсказать то, что сотрудник уволится из компании.

Для этого предобработал данные. Провел исследовательский анализ данных понял на какие категории делятся сотрудника. Узнал, что влияет на уровень удовлетворенности и отток сотрудников. Отобрал признаки, проверил их на мультиколлинеарность и утечку данных. Собрал два пайплана sklearn МО для разных задач с полным циклом подготовки данных. Получил предсказания и оценил пайлайн модели DTR кастомной метрикой SMAPE, а пайплайн классификации метрикой Roc-Auc

Технологии: Python, Pandas, matplotlib, Plotly, Sklearn, Numpy, phik

# Вывод по работе, написанный в конце файла .ipynb

## Задачи

Есть несколько задач.
Первая - построить модель, которая сможет
предсказать уровень удовлетворённости сотрудника на основе данных заказчика.
Почему бизнесу это важно: удовлетворённость работой напрямую влияет на
отток сотрудников. А предсказание оттока - одна из важнейших задач HR-
аналитиков. Внезапные увольнения несут в себе риски для компании, особенно
если уходит важный сотрудник.

Вторая задача - построить модель, которая сможет на основе данных
заказчика предсказать то, что сотрудник уволится из компании.


## Задача 1. Вывод
Работа над задачей велась в следующей последовательности

- **Знакомство с данными для задачи 1**
- **Предобработка данных для задачи 1**
- **Объединение test_features и test_target_job_satisfaction_rate**
- **Исследовательский анализ данных для задачи 1**
- **Корелляционный анализ данных для задачи 1**
- **Обучение модели машинного обучения для предсказания удовлетворенности человека работой**

Распишем подробнее
### Знакомство с данными для задачи 1


Для выполнения задачи 1 проекта (предсказание уровня удовлетворённости сотрудников) используются следующие датафреймы:

1. `train_job_satisfaction_rate`:
   - Назначение: Этот датафрейм содержит тренировочные данные с характеристиками сотрудников и их уровнем удовлетворённости работой. Он используется для обучения модели предсказывать уровень удовлетворённости сотрудников на основе различных признаков, таких как отдел, уровень должности, загруженность, длительность работы в компании, зарплата и т.д.
   - Содержимое: Включает признаки сотрудников (`dept`, `level`, `workload`, `employment_years`, `last_year_promo`, `last_year_violations`, `supervisor_evaluation`, `salary`) и целевой признак `job_satisfaction_rate` (уровень удовлетворённости). Содержит 4000 строк и 9 столбцов.

2. `test_features`:
   - Назначение: Данный датафрейм содержит тестовые данные, представляющие собой те же признаки, что и в тренировочных данных, но без целевого признака.
   - Содержимое: Включает признаки сотрудников (`id`, `dept`, `level`, `workload`, `employment_years`, `last_year_promo`, `last_year_violations`, `supervisor_evaluation`, `salary`). Содержит 2000 строк и 8 столбцов.

3. `test_target_job_satisfaction_rate`:
   - Назначение: Этот датафрейм содержит реальные значения уровня удовлетворённости для тестовых данных из `test_features`.
   - Содержимое: Содержит два столбца: `id` (идентификатор сотрудника) и `job_satisfaction_rate` (фактический уровень удовлетворённости). Содержит 2000 строк и 2 столбца.

Проведя анализ данных для задачи 1, мы видим следующее:

В датафрейме `train_job_satisfaction_rate` все количественные данные выглядят корректно. Мы проверили типы данных, характеристики и случайные строки. В колонках `level` и `dept` есть пропуски, которые нужно учесть при дальнейшем анализе. В целом, данные о количестве сотрудников, уровне загруженности, количестве лет работы, повышениях за последний год, нарушениях трудового договора, оценках руководителей, зарплате и уровне удовлетворённости сотрудников работой предоставлены в полном объёме и выглядят адекватно.

Распределения количественных переменных показывают правильные и ожидаемые результаты.

Для категориальных переменных типа 'object', таких как `dept`, `level`, `workload`, `last_year_promo` и `last_year_violations`, распределение значений также выглядит адекватно. Важно отметить, что в столбцах `dept` и `level` обнаружены пропуски. Будем обрабатывать

В датафрейме `test_features`, содержащем тестовые данные для модели, наблюдается схожая картина. Данные выглядят корректно, с небольшими пропусками в колонках `dept` и `level`.

В датафрейме `test_target_job_satisfaction_rate` все количественные данные также выглядят корректно. Данные о целевом уровне удовлетворённости сотрудников работой представлены в полном объёме, и распределение значений не вызывает вопросов.

Интересным моментом является то, что сотрудники выбраны в случайном порядке так как номера id идут не последовательно. Названия столбцов выполненены в соответсвие с форматом snake_case
### Предобработка данных для задачи 1


Работа в данном разделе состояла из нескольких этапов

**Удаление пропусков:**
1. В таблице `train_job_satisfaction_rate`:
   - Пропуски найдены в столбцах `dept` (6 пропусков) и `level` (4 пропуска). Это составляет менее 0.05% от всех данных, что является незначительной долей.

2. В таблице `test_features`:
   - Пропуски найдены в столбцах `dept` (2 пропуска) и `level` (1 пропуск). Эти пропуски также составляют менее 0.05% от всех данных. Также удалено 2 строки, где "dept" и "workload" принимают значение " "
     
3. В таблице `test_target_job_satisfaction_rate`:
   - Пропусков нет, все данные представлены полностью. Таблица содержит 2000 строк, каждая из которых имеет значения для всех столбцов.

Пропуски содержатся в незначительном количестве, они будут заполнены автоматически на этапе подготовки данных для МО
**Смена типов данных:**
На этапе знакомства с данными было выявлено, что необходимость в смене типов данных отсутствует. Все столбцы имеют корректные типы данных для анализа и моделирования.

**Смена значений в категориальных столбцах:**
На этапе знакомства с данными было определено, что необходимость в смене значений в категориальных столбцах отсутствует. Все значения представлены корректно и единообразно.

**Удаление явных дубликатов:**

Проверка всех таблиц на наличие явных дубликатов показала, что дубликаты отсутствуют:

- В таблице `train_job_satisfaction_rate` явные дубликаты отсутствуют.
- В таблице `test_features` явные дубликаты отсутствуют.
- В таблице `test_target_job_satisfaction_rate` явные дубликаты отсутствуют.

**Удаление неявных дубликатов:**

В каждой из таблиц даны уникальные id.
Есть вопросы к таблицам test_features и train_job_satisfaction_rate. Нужно запросить у заказчика дополнительную информацию и узнать, почему так много неуникальных наборов значений в строках.

Для test_features странно, что 40% сотрудников имеют "брата близнеца" с другим id, но с таким же стажем, должностью, количеством нарушений, зарплатой, оценкой директора
Для train_job_satisfaction_rate странно, что 10% сотрудников имеют имеют "брата близнеца" с другим id, но с таким же стажем, должностью, количеством нарушений, зарплатой, оценкой директора и удовлетворены работой настолько же сильно, насколько он

**Удаление выбросов во всех количественных непрерывных столбцах**
Проведен анализ выбросов в количественных непрерывных столбцах:

- В таблицах `train_job_satisfaction_rate` и `test_features` выбросы присутствуют в столбце `salary`, где наблюдаются высокие значения зарплаты (>80 тысяч).
- Принято решение не удалять эти выбросы, чтобы модель могла обучаться на данных, включающих высокооплачиваемых сотрудников, что важно для точности предсказаний.

В таблице `test_target_job_satisfaction_rate` нет столбцов с количественными непрерывными данными, поэтому анализ выбросов не проводился.

В результате проведенной предобработки данных все таблицы готовы для дальнейшего анализа и обучения моделей. Данные чисты от пропусков и дубликатов, выбросы обработаны соответствующим образом. Однако нужно пообщаться с заказчиком, чтобы должным образом интерпретировать неявные дубликаты и повысить качество моделирования.

### Объединение test_features и test_target_job_satisfaction_rate


Для удобного анализа данных и устранения случаев, когда либо целевой satisfaction_rate, либо другие признаки отсутсвуют так как id не согласованы, объединили  test_features и test_target_job_satisfaction_rate с типом соединения inner.
Новый датафрейм назвали test_job_satisfaction_rate.
### Исследовательский анализ данных для задачи 1


Провели анализ тренировочных данных для поиска удовлетворенности сотрудника train_job_satisfaction_rate. О нем ниже:

Распределение непрерывных переменных:

- Заработная плата: До 15% сотрудников получают до 20 тысяч. Около 45% зарабатывают от 25 до 35 тысяч. Примерно 35% получают от 35 до 60 тысяч, и только около 10% зарабатывают более 60 тысяч.
  
- Удовлетворенность работой: Распределение удовлетворенности выглядит бимодальным. Около 40% сотрудников имеют удовлетворенность на уровне 0.4, с хвостами распределения до 0.2 и 0.6. Вторая группа сотрудников удовлетворена на уровне 0.7, с хвостами в значениях 0.5 и 0.9.

Категориальные данные:

- Отдел:
  - Отдел продаж — 37.8% (1508 сотрудников).
  - Отдел технологий — 21.7% (866 сотрудников).
  - Отдел закупок — 15.3% (610 сотрудников).
  - Маркетинг — 13.8% (550 сотрудников).
  - Отдел кадров — 11.4% (456 сотрудников).

- Уровень должности:
  - Младшие должности занимают 47.3% (1888 сотрудников).
  - Средние должности занимают 43.7% (1744 сотрудников).
  - Старшие должности занимают 9.0% (358 сотрудников).

- Загруженность:
  - Средний уровень загруженности — 51.6% (2060 сотрудников).
  - Низкая загруженность — 30.0% (1197 сотрудников).
  - Высокая загруженность — 18.4% (733 сотрудника).

- Повышение за последний год: 97.0% (3870 сотрудников) не получали повышения, только 3.0% (120 сотрудников) были повышены.

- Нарушения за последний год: 86.0% (3432 сотрудника) не имели нарушений, 14.0% (558 сотрудников) имели нарушения.

Дискретные числовые перееменные (имеют лишь несколько уникальных значений_:

- Стаж работы: Средняя длительность работы — 3.72 года, медианное значение — 3.0 года, с минимумом — 1 год и максимумом — 10 лет. У 25% сотрудников стаж не превышает 2 лет, а у 75% — не превышает 6 лет.

- Оценка руководителя (`supervisor_evaluation`): Средняя оценка — 3.48, медианное значение — 4.0. Значения варьируются от 1 до 5. У 25% сотрудников оценка не превышает 3, а у 75% — не превышает 4.
  - Оценка "4" — 39.9% (1597 сотрудников).
  - Оценка "3" — 31.6% (1261 сотрудник).
  - Оценка "5" — 13.6% (544 сотрудника).
  - Оценка "2" — 9.7% (387 сотрудников).
  - Оценка "1" — 5.0% (201 сотрудник).
    
Взаимосвязи между переменными:

- При росте зарплаты уровень удовлетворенности немного увеличивается.
- Более высокая оценка сотрудника руководителем коррелирует с более высокой удовлетворенностью работой.
- Чем дольше сотрудник работает в компании, тем выше его удовлетворенность.
- Сотрудники, нарушавшие трудовой договор, менее удовлетворены работой по сравнению с теми, кто не совершал нарушений.


Данные для тестирования модели для поиска удовлетворенности сотрудника test_job_satisfaction_rate похожи на тренировочные данные по всем параметрам
### Корелляционный анализ данных для задачи 1


Для train_job_satisfaction_rate и test_job_satisfaction_rate определили переменные, которые коррелирует с job_satisfaction_rate

- Категориальные переменные: (Фи использовали для категориальных переменных)

    - Повышение за последний год: Наблюдается слабая корреляция между job_satisfaction_rate и наличием повышения в прошлом году.
    - Нарушения трудового договора в предыдущем году: Существует умеренная корреляция между job_satisfaction_rate и нарушением трудового договора в предыдущем году.
    - Другие категориальные переменные: Корреляция job_satisfaction_rate с другими категориальными переменными отсутствует.

- Числовые переменные: (Спирмен. Использовали так как числовые переменные распределены не нормально)

    - Оценка руководителя (supervisor_evaluation): Существует сильная корреляция между job_satisfaction_rate и оценкой руководителя.
    - Стаж работы (employment_years): Наблюдается слабая корреляция между job_satisfaction_rate и стажем работы.
    - Зарплата (salary): Корреляция между job_satisfaction_rate и зарплатой не была обнаружена

Мультиколлинерность и утечка целевого признака отсутствуют. Хорошей практикой было бы кодировать порядковые категориальные переменные и использовать корелляцию Пирсона для level, workload

Мультиколлинерность и утечка целевого признака отсутствуют. Хорошей практикой было бы кодировать порядковые категориальные переменные и использовать корелляцию Пирсона для level, workload
### Обучение модели машинного обучения для предсказания удовлетворенности человека работой
Работа в этом разделе состояла из следующих этапов

**Подготовка данных:**

Для нормализации числовых данных были использованы различные методы нормализации: RobustScaler, MinMaxScaler, StandardScaler.
Порядковые категориальные переменные, такие как level и workload, были закодированы с помощью OrdinalEncoder, используя явный порядок категорий.
Остальные категориальные переменные, такие как dept, last_year_promo, и last_year_violations, были закодированы с помощью OneHotEncoder.
    
**Обучение модели МО:**

Для предсказания уровня удовлетворенности работой использовались модели DcisionTreeRegressor и LinearRegression.
Для настройки гиперпараметров моделей использовался RandomizedSearchCV.
Лучшая модель — DecisionTreeRegressor с параметрами max_depth=98, max_features=85, max_leaf_nodes=253, min_samples_split=3. Для числовых признаков была выбрана нормализация с помощью RobustScaler.
На тестовой выборке модель достигла метрики SMAPE = 13.79, что ниже порогового значения 15, заданного в условиях задачи.

**Оценка важности признаков:**

Наибольший вклад в предсказание модели вносит признак supervisor_evaluation с важностью 0.681602.
Другие значимые признаки, такие как salary, employment_years, last_year_violations_yes, и level, имеют значительно меньшую важность, в 8 и более раз менее важные по сравнению с оценкой руководителя.
Менее значимые признаки включают workload, last_year_promo_yes, и различные отделы, но их важность минимальна.

**Почему победила именно это модель?**

Модель DecionTreeRegression устойчива к выбросам, которые есть как минимум в столбце salary. Может распознавать нелинейные зависимости в данных

**Повышение точности:**

Для улучшения точности стоит попробовать преобразовать данные, например возведя числовые признаки в степень, или создать дополнительный опрос для руководителей отделом чем именно они довольны в сотрудниках, а чем нет, ведь их оценка действительно позволяет предсказать уровень удовлетворенности
## Задача 2. Вывод
### Знакомство с данными для задачи 2
**Таблицу `test_features` просмотрели на этапе "Знакомство с данными для задачи 2", ниже говорится только о train_quit и test_target_quit**


Проведя анализ данных для задачи 2 (предсказание оттока сотрудников), мы видим следующее:

1. В датафрейме `train_quit`:
   - Датафрейм содержит 4000 строк и 10 столбцов, без пропусков. Данные представлены полностью для всех столбцов: `id`, `dept`, `level`, `workload`, `employment_years`, `last_year_promo`, `last_year_violations`, `supervisor_evaluation`, `salary`, и `quit`.
   - Количественные переменные (`id`, `employment_years`, `supervisor_evaluation`, `salary`) имеют ожидаемые распределения. Это подтверждается как описательной статистикой, так и визуализацией распределений на гистограммах.
   - Категориальные переменные (`dept`, `level`, `workload`, `last_year_promo`, `last_year_violations`, и `quit`) также имеют ожидаемые распределения, что позволяет использовать их в модели без дополнительной обработки. Например, переменная `quit` показывает, что 2872 сотрудника остаются на работе, а 1128 уволились, что соответствует заданной задаче по предсказанию оттока.

2. В датафрейме `test_target_quit`:
   - Датафрейм содержит 2000 строк и 2 столбца: `id` и `quit`. Пропусков нет, все данные представлены полностью. Это целевой датафрейм для тестирования модели, и он содержит данные о том, уволились ли сотрудники.
   - Количественные переменные (`id`) и целевая переменная (`quit`) также имеют правильные распределения. Целевая переменная `quit` показывает, что из 2000 сотрудников 564 уволились, а 1436 остались, что поможет оценить точность модели.

Интересным моментом является то, что сотрудники выбраны в случайном порядке так как номера id идут не последовательно. Названия столбцов выполненены в соответсвие с форматом snake_case
### Предобработка данных для задачи 2

**Таблицу `test_features` предобработали на этапе "Предобработка данных для задачи 1", ниже говорится только о train_quit и test_target_quit**

Работа в данном разделе состояла из нескольких этапов

**Удаление пропусков:**

Пропуски отсутствуют

**Смена типов данных:**

На этапе знакомства с данными было выявлено, что необходимость в смене типов данных отсутствует. Все столбцы имеют корректные типы данных для анализа и моделирования.

**Смена значений в категориальных столбцах:**
С этапа "Знакомство с данными", помним, что необходимость в смене значений в категориальных столбцах отстутвует

**Удаление явных дубликатов:**

Явные дубликаты отсутсвуют

**Удаление неявных дубликатов:**

Видим, что в каждой из таблиц даны уникальные id.
Есть вопросы к таблице train_quit. Нужно запросить у заказчика дополнительную информацию и узнать, почему так много неуникальных наборов значений в строках.

Для train_quit странно, что 50% сотрудников имеют "брата близнеца" с другим id, но с таким же стажем, должностью, количеством нарушений, зарплатой, оценкой директора

**Удаление выбросов во всех количественных непрерывных столбцах**

Проведен анализ выбросов в количественных непрерывных столбцах:

- В таблие `train_quit` выбросы присутствуют в столбце `salary`, где наблюдаются высокие значения зарплаты (>80 тысяч).
- Принято решение не удалять эти выбросы, чтобы модель могла обучаться на данных, включающих высокооплачиваемых сотрудников, что важно для точности предсказаний.

В таблице `test_target_quit` нет столбцов с количественными непрерывными данными, поэтому анализ выбросов не проводился.
### Объединение test_features и test_target_quit
Для удобного анализа данных и устранения случаев, когда либо целевой quit, либо другие признаки отсутсвуют так как id не согласованы, объединили  test_features и test_target_quit с типом соединения inner. Новый датафрейм назвали test_quit.
### Исследовательский анализ данных для задачи 2
**Таблицу `test_features` описали на этапе Исследовательский анализ данных для задачи 1, ниже говорится только о train_quit и test_target_quit**
Соберем во едино всю информацию из раздела

**Данные в train_quit и test_quit**

Распределение непрерывных переменных:

Заработная плата: Около 15% сотрудников получают до 20 тысяч. Примерно 45% зарабатывают от 25 до 35 тысяч. Около 35% получают от 35 до 60 тысяч, и только около 10% зарабатывают более 60 тысяч.

Удовлетворенность работой: Распределение удовлетворенности выглядит бимодальным. Около 40% сотрудников имеют удовлетворенность на уровне 0.4, с хвостами распределения до 0.2 и 0.6. Вторая группа сотрудников удовлетворена на уровне 0.7, с хвостами в значениях 0.5 и 0.9.

Категориальные данные:

Отдел:

Отдел продаж — 35.9% (1438 сотрудников).
Отдел технологий — 23.2% (928 сотрудников).
Отдел закупок — 14.7% (588 сотрудников).
Маркетинг — 14.6% (582 сотрудника).
Отдел кадров — 11.6% (464 сотрудника).
Уровень должности:

Младшие должности занимают 48.7% (1949 сотрудников).
Средние должности занимают 42.4% (1694 сотрудников).
Старшие должности занимают 8.9% (357 сотрудников).
Загруженность:

Средний уровень загруженности — 52.9% (2118 сотрудников).
Низкая загруженность — 30.2% (1208 сотрудников).
Высокая загруженность — 16.9% (674 сотрудника).
Повышение за последний год: 97.2% (3887 сотрудников) не получили повышения, тогда как только 2.8% (113 сотрудников) были повышены.

Нарушения за последний год: 86.4% (3455 сотрудников) не имели нарушений, 13.6% (545 сотрудников) имели нарушения.

Дискретные числовые переменные (имеют лишь несколько уникальных значений):

Стаж работы: Средняя длительность работы — 3.72 года, медианное значение — 3.0 года, с минимумом — 1 год и максимумом — 10 лет. У 25% сотрудников стаж не превышает 2 лет, а у 75% — не превышает 6 лет.

Оценка руководителя (supervisor_evaluation): Средняя оценка — 3.48, медианное значение — 4.0. Значения варьируются от 1 до 5. У 25% сотрудников оценка не превышает 3, а у 75% — не превышает 4.

Оценка "4" — 41.4% (1654 сотрудника).
Оценка "3" — 30.8% (1233 сотрудника).
Оценка "5" — 13.0% (520 сотрудников).
Оценка "2" — 9.8% (391 сотрудник).
Оценка "1" — 5.1% (202 сотрудника).

Данные для тестирования модели для предсказания увольнения сотрудника test_quit похожи на тренировочные данные по всем параметрам

**Портрет уволившегося сотрудника**

Вот характеристики уволившегося сотрудника

Зарплата:

Медианная зарплата уволившихся (22,800) сотрудников на 12,000 ниже, чем у оставшихся (34,800).
Средняя зарплата оставшихся сотрудников: 37,702.23 Ушедших сотрудники: 23,885.11.
Значение 75-го перцентиля уволившихся сотрудников на 19,200 ниже.
Значение 25-го перцентиля на 8,400 ниже, чем у оставшихся.
Минимальная зарплата одинакова для обеих групп.
Максимальная зарплата уволившихся сотрудников на 16,800 ниже, чем у оставшихся.

Стаж работы:

В 90% случаев уволившиеся сотрудники проработали в компании менее 3 лет.

Уровень должности:

В 90% случаев уволившиеся сотрудники занимали позицию junior.

Нарушения трудового договора:

Уволившиеся сотрудники в два раза чаще нарушали условия трудового договора по сравнению с оставшимися.

Оценка работы:

Уволившиеся сотрудники в среднем в два раза чаще получали оценки за работу 1, 2 или 3.

Рабочая нагрузка:

В большинстве случаев рабочая нагрузка уволившихся сотрудников была низкой.

**Проверка утверждения о том, что уровень удовлетворенности влияет на увольнение**

Можно сказать, что уровень удовлетворенности работой уволишихся сотрудников и оставшихся сильно различается. В 90% случаев оставшиеся сотрудники удовлетворенны работой от 0.5 единиц. Уволившиеся сотрудники, напротив, в 70% случаев удовлетворены работой до 0.5 единиц
### Корелляционный анализ данных для задачи 2


Для train_quit определили переменные, которые коррелирует с quit. Для test_full_data корелляции примерно такие же

Корреляция между другими величинами и quit (quit категориальная, использовали корелляцию фи):

- Стаж работы (employment_years): Наблюдается сильная корреляция между quit и количеством лет работы.
- Уровень должности (level): Умеренная корреляция.
- Зарплата (salary): Умеренная корреляция.
- Оценка руководителя (supervisor_evaluation): Умеренная корреляция.
- Нарушения трудового договора в предыдущем году (last_year_violations): Существует слабая корреляция между quit и нарушением трудового договора в предыдущем году.
- Повышение за последний год (last_year_promo): Слабая корреляция.
- Удовлетворенность работой (job_satisfaction_rate): Умеренная корреляция. Сотрудники с более низкой удовлетворенностью работой чаще покидают компанию.
- Рабочая нагрузка (workload): Низкая корреляция. Сотрудники с определенной загруженностью могут быть более склонны к увольнению, но влияние нагрузки не является значительным.

С остальными переменными корелляция отсутствует. Утечки целевого признака нет, мультиколлинеарность отсутсвует
### Обучение модели машинного обучения для предсказания удовлетворенности человека работой
Работа в этом разделе состояла из следующих этапов:

1. Подготовка данных:
   - Для нормализации числовых данных были использованы различные методы нормализации: RobustScaler, MinMaxScaler, StandardScaler.
   - Порядковые категориальные переменные, такие как `level` и `workload`, были закодированы с помощью OrdinalEncoder, используя явный порядок категорий.
   - Остальные категориальные переменные, такие как `dept`, `last_year_promo`, и `last_year_violations`, были закодированы с помощью OneHotEncoder.

2. Обучение модели машинного обучения:
   - Для предсказания вероятности увольнения использовались модели DecisionTreeClassifier, KNeighborsClassifier, и LogisticRegression.
   - Для настройки гиперпараметров моделей использовался RandomizedSearchCV.
   - Лучшая модель — DecisionTreeClassifier с параметрами `max_depth=33`, `min_samples_leaf=14`, `min_samples_split=6`, `random_state=42`.
   - Нормализатор для числовых признаков — MinMaxScaler.
   - Метрика ROC-AUC лучшей модели при кросс-валидации составила 0.93.
   - Метрика ROC-AUC на тестовой выборке составила 0.925.

3. Оценка важности признаков:
   - Наибольший вклад в предсказание модели вносит признак `num__job_satisfaction_rate` с важностью 0.458989.
   - Признак `ord__level` также важен, но в 1.25 раза менее значим, чем основной признак.
   - Признаки `num__salary` и `num__employment_years` имеют в 5 раз меньшую важность.
   - Менее значимые признаки, такие как `ord__workload`, `num__supervisor_evaluation`, и различные категории департаментов, имеют значительно меньшую важность — в 45 и более раз менее важны, чем основной признак.

4. Повышение точности:
   - Для улучшения точности стоит попробовать преобразовать данные, например, возведя числовые признаки в степень, или повысить точность предсказания удовлетворенности работой
```
# Рекомендации для бизнеса
## Рекомендации по сбору данных
- Стоит сделать поля workload и debt обязательными при сборе данных, сейчас в них встречаются пропуски
- Вместо опроса сотрудников об удовлетворенности работой, можно детальнее распрашивать руководителей про подчиненных, ведь оценка руководителей помогает предположить уровень удовлетворенности работой сильнее всего
## Рекомендации по снижению количества увольнений
Мы разработали модель по предсказанию увольнений, она поможет снизить количество таких случаев. Если модель предположила, что сотрудник уволится, на основе анализа данных, можно сказать, что первой мерой по предотвращению уволенения будет повышение зарплаты. Также можно расспросить руководителя человека как сделать так, чтобы подчиненный работал лучше, добавить больше гибкости в трудовой договор для предотвращения его нарущения. Заметно, что увольняющиеся сотрудники работают первый или второй год. Возможно использовать тактики по отложенному вознаграждению, как премия 100 тысяч за год работы или раздача акций компании
# ТЗ

## Описание проекта

Позади много уроков и заданий, и закрепить свои знания, как обычно, вы сможете в самостоятельном проекте. Это непростой проект, в котором от вас потребуется больше самостоятельности. Этапы работы описаны кратко, и вам понадобится декомпозировать задачи, то есть разделить их на более мелкие. Опирайтесь на знания об этапах анализа данных и машинного обучения из прошлых курсов.

Перейдём к задаче. HR-аналитики компании «Работа с заботой» помогают бизнесу оптимизировать управление персоналом: бизнес предоставляет данные, а аналитики предлагают, как избежать финансовых потерь и оттока сотрудников. В этом HR-аналитикам пригодится машинное обучение, с помощью которого получится быстрее и точнее отвечать на вопросы бизнеса.

Компания предоставила данные с характеристиками сотрудников компании. Среди них — уровень удовлетворённости сотрудника работой в компании. Эту информацию получили из форм обратной связи: сотрудники заполняют тест-опросник, и по его результатам рассчитывается доля их удовлетворённости от 0 до 1, где 0 — совершенно неудовлетворён, 1 — полностью удовлетворён.

Собирать данные такими опросниками не так легко: компания большая, и всех сотрудников надо сначала оповестить об опросе, а затем проследить, что все его прошли.

У вас будет несколько задач. Первая — построить модель, которая сможет предсказать уровень удовлетворённости сотрудника на основе данных заказчика.

Почему бизнесу это важно: удовлетворённость работой напрямую влияет на отток сотрудников. А предсказание оттока — одна из важнейших задач HR-аналитиков. Внезапные увольнения несут в себе риски для компании, особенно если уходит важный сотрудник.

Ваша вторая задача — построить модель, которая сможет на основе данных заказчика предсказать то, что сотрудник уволится из компании.

Теперь расскажем подробнее о задачах.

## Задача 1: предсказание уровня удовлетворённости сотрудника

Для этой задачи заказчик предоставил данные с признаками:

- **id** — уникальный идентификатор сотрудника;
- **dept** — отдел, в котором работает сотрудник;
- **level** — уровень занимаемой должности;
- **workload** — уровень загруженности сотрудника;
- **employment_years** — длительность работы в компании (в годах);
- **last_year_promo** — показывает, было ли повышение за последний год;
- **last_year_violations** — показывает, нарушал ли сотрудник трудовой договор за последний год;
- **supervisor_evaluation** — оценка качества работы сотрудника, которую дал руководитель;
- **salary** — ежемесячная зарплата сотрудника;
- **job_satisfaction_rate** — уровень удовлетворённости сотрудника работой в компании, целевой признак.

### Шаг 1. Загрузка данных

Загрузите файлы с данными:

- **Тренировочная выборка:**
  - `train_job_satisfaction_rate.csv`
- **Входные признаки тестовой выборки:**
  - `test_features.csv`
- **Целевой признак тестовой выборки:**
  - `test_target_job_satisfaction_rate.csv`

### Шаг 2. Предобработка данных

Изучите данные и сделайте выводы. При необходимости выполните предобработку. Если есть пропуски, заполните их в пайплайне.

### Шаг 3. Исследовательский анализ данных

Исследуйте все признаки и сделайте выводы о том, как их нужно подготовить.

### Шаг 4. Подготовка данных

Подготовку признаков выполните в пайплайне, дополнив пайплайн шагом предобработки. При кодировании учитывайте особенности признаков и моделей и используйте как минимум два кодировщика.

### Шаг 5. Обучение моделей

Обучите как минимум две модели. Возьмите одну линейную модель, а в качестве второй — дерево решений. Подберите гиперпараметры как минимум для одной модели с помощью одного из известных вам инструментов.

Выберите лучшую модель и проверьте её качество. Выбор делайте на основе новой метрики — SMAPE (англ. symmetric mean absolute percentage error, «симметричное среднее абсолютное процентное отклонение»).

Метрика SMAPE вычисляется так:

SMAPE = 100 / n * ∑<sub>i=1</sub><sup>n</sup> (|y<sub>i</sub> − ŷ<sub>i</sub>| / ((|y<sub>i</sub>| + |ŷ<sub>i</sub>|) / 2)),

где:
- y<sub>i</sub> — фактическое значение целевого признака для объекта с порядковым номером i в выборке;
- ŷ<sub>i</sub> — предсказанное значение целевого признака для объекта с порядковым номером i в выборке;
- n — количество объектов в выборке;
- ∑<sub>i=1</sub><sup>n</sup> — сумма значений, полученная в результате операций, которые следуют за этим знаком, для всех объектов с порядковым номером от i до n в выборке.

Напишите функцию, которая принимает на вход массивы NumPy или объекты Series в pandas и возвращает значение метрики SMAPE. Используйте эту метрику при подборе гиперпараметров и оценке качества моделей.

Критерий успеха: SMAPE ≤ 15 на тестовой выборке.

В решении сохраните работу со всеми моделями, которые вы пробовали. Сделайте выводы.

### Шаг 6. Оформление выводов

Сделайте промежуточные выводы о том, какая модель справилась лучше и почему.

## Задача 2: предсказание увольнения сотрудника из компании

Для этой задачи вы можете использовать те же входные признаки, что и в предыдущей задаче. Однако целевой признак отличается: это **quit** — увольнение сотрудника из компании.

### Шаг 1. Загрузка данных

Загрузите данные из файлов:

- **Тренировочная выборка:**
  - `train_quit.csv`
- **Входные признаки тестовой выборки** те же, что и в прошлой задаче:
  - `test_features.csv`
- **Целевой признак тестовой выборки:**
  - `test_target_quit.csv`

### Шаг 2. Предобработка данных

Изучите данные и при необходимости выполните предобработку. Если есть пропуски, заполните их в пайплайне.

### Шаг 3. Исследовательский анализ данных

1. Проведите исследовательский анализ данных.
2. Составьте портрет «уволившегося сотрудника». Например, можно узнать, в каком отделе с большей вероятностью работает уволившийся сотрудник и какой у него уровень загруженности. Также можно сравнить среднее значение зарплаты ушедших сотрудников с теми, кто остался в компании.
3. Аналитики утверждают, что уровень удовлетворённости сотрудника работой в компании влияет на то, уволится ли сотрудник. Проверьте это утверждение: визуализируйте и сравните распределения признака **job_satisfaction_rate** для ушедших и оставшихся сотрудников. Используйте данные с обоими целевыми признаками тестовой выборки.

### Шаг 4. Добавление нового входного признака

Допустим, **job_satisfaction_rate** и **quit** действительно связаны и вы получили необходимое значение метрики в первой задаче. Тогда добавьте **job_satisfaction_rate**, предсказанный лучшей моделью первой задачи, к входным признакам второй задачи.

### Шаг 5. Подготовка данных

Подготовьте признаки так же, как и в первой задаче: выполните подготовку в пайплайне, дополнив пайплайн предобработки. При кодировании учитывайте особенности признаков и моделей и используйте как минимум два кодировщика.

### Шаг 6. Обучение модели

Обучите как минимум три модели. Как минимум для двух из них подберите гиперпараметры. Проверьте качество лучшей модели.

Метрика оценки качества в этой задаче — ROC-AUC. Критерий успеха: ROC-AUC ≥ 0.91 на тестовой выборке. Напомним: отбор признаков часто помогает улучшить метрику.

### Шаг 7. Выводы

Сделайте промежуточные выводы о том, какая модель справилась лучше и почему.

## Общий вывод

Сформулируйте общий вывод:
- опишите задачу;
- опишите все этапы работы;
- добавьте выводы и дополнительные предложения для бизнеса.

## Оформление

Выполните задание в Jupyter Notebook. Заполните программный код в ячейках типа **code**, текстовые пояснения — в ячейках типа **markdown**. Используйте форматирование и заголовки.

## Как будут проверять мой проект

Ваш проект будут оценивать по критериям. Прежде чем решать кейс, внимательно изучите их.

### На что обращают внимание при проверке проектов:

- как вы описываете найденные в данных проблемы;
- какие методы построения графиков применяете для исследовательского анализа;
- какие методы предобработки и подготовки данных применяете и как обосновываете принятое решение;
- используете ли пайплайны и автоматизируете ли повторяющиеся шаги;
- какие ML-решения вы реализуете;
- как выбираете и объясняете лучшее ML-решение;
- как вы интерпретируете результаты работы лучшей модели;
- соблюдаете ли структуру проекта и поддерживаете ли аккуратность кода;
- какие выводы делаете для бизнеса;
- оставляете ли комментарии к шагам.

Успехов!


# Технический комментарий
- Версия с опциональной критикой без правок
- Emerald